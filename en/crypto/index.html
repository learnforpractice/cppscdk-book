
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../database/">
      
      
        <link rel="next" href="../abi/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.4">
    
    
      
        <title>Cryptography-related Functions - C++ Smart Contracts Development Cook Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.240905d7.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cryptography-related-functions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../" title="C++ Smart Contracts Development Cook Book" class="md-header__button md-logo" aria-label="C++ Smart Contracts Development Cook Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            C++ Smart Contracts Development Cook Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cryptography-related Functions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="../../crypto/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="../../zh/crypto/" hreflang="zh" class="md-select__link">
                    中文
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/learnforpractice/cppscdk-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../" title="C++ Smart Contracts Development Cook Book" class="md-nav__button md-logo" aria-label="C++ Smart Contracts Development Cook Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    C++ Smart Contracts Development Cook Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/learnforpractice/cppscdk-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../prelude/" class="md-nav__link">
        Prerequisite Knowledge
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../env/" class="md-nav__link">
        Setting Up the Development Environment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        Common Smart Contract Functions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../action/" class="md-nav__link">
        Use of Inline Action in Smart Contracts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../notify/" class="md-nav__link">
        require_recipient Function
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../database/" class="md-nav__link">
        Database Operations
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Cryptography-related Functions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Cryptography-related Functions
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sha256" class="md-nav__link">
    sha256
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sha1" class="md-nav__link">
    sha1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sha512" class="md-nav__link">
    sha512
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ripemd160" class="md-nav__link">
    ripemd160
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recover_key" class="md-nav__link">
    recover_key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example:
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../abi/" class="md-nav__link">
        Detailed Explanation of ABI Types
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deploy/" class="md-nav__link">
        Deploying a Smart Contract
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ui/" class="md-nav__link">
        Interact with Digital Wallets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../hello-cmake/" class="md-nav__link">
        Compiling Code with CMake
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sha256" class="md-nav__link">
    sha256
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sha1" class="md-nav__link">
    sha1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sha512" class="md-nav__link">
    sha512
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ripemd160" class="md-nav__link">
    ripemd160
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recover_key" class="md-nav__link">
    recover_key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example:
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="cryptography-related-functions">Cryptography-related Functions</h1>
<p>Cryptography-related functions are defined in the CDT's <a href="https://github.com/AntelopeIO/cdt/blob/6f9531319ded3633d47676f4d1ab57b9001ff985/libraries/eosiolib/core/eosio/crypto.hpp">crypto.hpp</a>.</p>
<h2 id="sha256">sha256</h2>
<p>sha256 algorithm hash function</p>
<div class="highlight"><pre><span></span><code><span class="n">eosio</span><span class="o">::</span><span class="n">checksum256</span><span class="w"> </span><span class="nf">sha256</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Used to check whether the hash256 value is normal, incorrect values will directly throw an exception</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">assert_sha256</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">checksum256</span><span class="o">&amp;</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<h2 id="sha1">sha1</h2>
<p>sha1 algorithm hash function</p>
<div class="highlight"><pre><span></span><code><span class="n">eosio</span><span class="o">::</span><span class="n">checksum160</span><span class="w"> </span><span class="nf">sha1</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Used to check whether the sha1 hash value is normal, incorrect values will directly throw an exception</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">assert_sha1</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">checksum160</span><span class="o">&amp;</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<h2 id="sha512">sha512</h2>
<p>sha512 algorithm hash function</p>
<div class="highlight"><pre><span></span><code><span class="n">eosio</span><span class="o">::</span><span class="n">checksum512</span><span class="w"> </span><span class="nf">sha512</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Used to check whether the hash512 value is normal, incorrect values will directly throw an exception</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">assert_sha512</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">checksum512</span><span class="o">&amp;</span><span class="w"> </span><span class="n">hash</span><span class="p">);</span>
</code></pre></div>
<h2 id="ripemd160">ripemd160</h2>
<p>ripemd160 algorithm hash function</p>
<div class="highlight"><pre><span></span><code><span class="n">eosio</span><span class="o">::</span><span class="n">checksum160</span><span class="w"> </span><span class="nf">ripemd160</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Used to check whether the hash value of the ripemd160 algorithm is normal, incorrect values will directly throw an exception</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">assert_ripemd160</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">checksum160</span><span class="o">&amp;</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<h2 id="recover_key">recover_key</h2>
<p>Used to recover the public key from the digest and signature</p>
<div class="highlight"><pre><span></span><code><span class="n">eosio</span><span class="o">::</span><span class="n">public_key</span><span class="w"> </span><span class="nf">recover_key</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">checksum256</span><span class="o">&amp;</span><span class="w"> </span><span class="n">digest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">signature</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sig</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Checks whether the signature is normal, abnormal will throw an exception</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">assert_recover_key</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">checksum256</span><span class="o">&amp;</span><span class="w"> </span><span class="n">digest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">signature</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sig</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">eosio</span><span class="o">::</span><span class="n">public_key</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pubkey</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<h2 id="example">Example:</h2>
<p><a href="https://github.com/learnforpractice/cppscdk-book/tree/master/examples/cryptotest">Full Example Code</a></p>
<div class="highlight"><pre><span></span><code><span class="p">[[</span><span class="n">eosio</span><span class="o">::</span><span class="n">action</span><span class="p">(</span><span class="s">&quot;testhash&quot;</span><span class="p">)]]</span>
<span class="kt">void</span><span class="w"> </span><span class="n">test_contract</span><span class="o">::</span><span class="n">test_hash</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="s">&quot;hello, world&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">assert_sha256</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">sha256</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
<span class="w">    </span><span class="n">assert_sha1</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">sha1</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
<span class="w">    </span><span class="n">assert_sha512</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">sha512</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
<span class="w">    </span><span class="n">assert_ripemd160</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">ripemd160</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
<span class="p">}</span>

<span class="p">[[</span><span class="n">eosio</span><span class="o">::</span><span class="n">action</span><span class="p">(</span><span class="s">&quot;testrecover&quot;</span><span class="p">)]]</span>
<span class="kt">void</span><span class="w"> </span><span class="n">test_contract</span><span class="o">::</span><span class="n">test_recover</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">sig</span><span class="p">,</span><span class="w"> </span><span class="n">public_key</span><span class="w"> </span><span class="n">pub_key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">digest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sha256</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">pub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recover_key</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span><span class="w"> </span><span class="n">sig</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">pub</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pub_key</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid signature&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">assert_recover_key</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span><span class="w"> </span><span class="n">sig</span><span class="p">,</span><span class="w"> </span><span class="n">pub_key</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Test Code:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@chain_test</span>
<span class="k">def</span> <span class="nf">test_hash</span><span class="p">(</span><span class="n">tester</span><span class="p">):</span>
    <span class="n">deploy_contract</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">push_action</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;testhash&#39;</span><span class="p">,</span> <span class="p">{},{</span><span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;active&#39;</span><span class="p">})</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;++++++elapsed: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;elapsed&#39;</span><span class="p">])</span>
    <span class="n">tester</span><span class="o">.</span><span class="n">produce_block</span><span class="p">()</span>

<span class="nd">@chain_test</span>
<span class="k">def</span> <span class="nf">test_recover_key</span><span class="p">(</span><span class="n">tester</span><span class="p">):</span>
    <span class="n">deploy_contract</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">create_key</span><span class="p">()</span>
    <span class="n">pub</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">]</span>
    <span class="n">priv</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;private&#39;</span><span class="p">]</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;hello, world&#39;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
    <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">sign_digest</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="n">priv</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span>
        <span class="s1">&#39;sig&#39;</span><span class="p">:</span> <span class="n">sig</span><span class="p">,</span>
        <span class="s1">&#39;pub_key&#39;</span><span class="p">:</span> <span class="n">pub</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">push_action</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;testrecover&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;active&#39;</span><span class="p">})</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;++++++elapsed: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;elapsed&#39;</span><span class="p">])</span>
    <span class="n">tester</span><span class="o">.</span><span class="n">produce_block</span><span class="p">()</span>
</code></pre></div>
<p>Compilation:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>examples/cryptotest
cdt-cpp<span class="w"> </span>test.cpp
</code></pre></div>
<p>Testing:</p>
<div class="highlight"><pre><span></span><code>ipyeos -m pytest -s -x test.py -k test_hash
ipyeos -m pytest -s -x test.py -k test_recover_key
</code></pre></div>
<p>In this example code, the common usage of hash functions and the usage of <code>recover_key</code> and <code>assert_recover_key</code> are demonstrated. The usage of hash functions is quite simple, here is an explanation of the test code for <code>recover_key</code>:
<code>recover_key</code> accepts two parameters, <code>digest</code> and <code>signature</code>. Digest is the result of running sha256 on a binary data. In the above code, it is calculated by hashing <code>hello, world</code> using the sha256 algorithm, as shown in the following code:</p>
<div class="highlight"><pre><span></span><code><span class="n">msg</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;hello, world&#39;</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">sign_digest</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="n">priv</span><span class="p">)</span>
</code></pre></div>
<p>The <code>eos.sign_digest</code> is used to sign data.</p>
<p>Below is the explanation for <code>testrecover</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">[[</span><span class="n">eosio</span><span class="o">::</span><span class="n">action</span><span class="p">(</span><span class="s">&quot;testrecover&quot;</span><span class="p">)]]</span>
<span class="kt">void</span><span class="w"> </span><span class="n">test_contract</span><span class="o">::</span><span class="n">test_recover</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">sig</span><span class="p">,</span><span class="w"> </span><span class="n">public_key</span><span class="w"> </span><span class="n">pub_key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">digest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sha256</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">pub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recover_key</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span><span class="w"> </span><span class="n">sig</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">pub</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pub_key</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid signature&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">assert_recover_key</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span><span class="w"> </span><span class="n">sig</span><span class="p">,</span><span class="w"> </span><span class="n">pub_key</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>The principle of <code>recover_key</code> is the same as the verification of the signature in the Transaction by the node. The user signs the digest, and then the third party verifies it with the public key.
In actual smart contract applications, if you need to determine in the smart contract whether a piece of binary data is signed with a specific private key, you can use the above method. The process is as follows:</p>
<ul>
<li>The contract saves a public key corresponding to the user's private key</li>
<li>The user signs the data with their own private key</li>
<li>The user sends the data and its corresponding signature to the smart contract</li>
<li>The smart contract can call <code>recover_key</code> to recover the public key from the user data and the signature of the data</li>
<li>The smart contract reads the user's public key saved on the chain, and compares it with the public key recovered by calling <code>recover_key</code>. If they are the same, it can be determined that the data is signed by the corresponding user.</li>
</ul>





  <h2 id="__comments">Comments</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
        data-repo="learnforpractice/cppscdk-book"
        data-repo-id="R_kgDOJoxETQ"
        data-category="Q&A"
        data-category-id="DIC_kwDOJoxETc4CW4Pz"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    // document.addEventListener("DOMContentLoaded", function() {
    //   var ref = document.querySelector("[data-md-component=palette]")
    //   ref.addEventListener("change", function() {
    //     var palette = __md_get("__palette")
    //     if (palette && typeof palette.color === "object") {
    //       var theme = palette.color.scheme === "slate" ? "dark" : "light"

    //       /* Instruct Giscus to change theme */
    //       var frame = document.querySelector(".giscus-frame")
    //       frame.contentWindow.postMessage(
    //         { giscus: { setConfig: { theme } } },
    //         "https://giscus.app"
    //       )
    //     }
    //   })
    // })
  </script>

                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.19047be9.min.js"></script>
      
    
  </body>
</html>